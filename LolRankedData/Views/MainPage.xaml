<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:LolRankedData.ViewModels"
             x:Class="LolRankedData.Views.MainPage"
             Title="LOL Ranked Data"
             BackgroundColor="#1a1a2e">

    <ScrollView>
        <Grid Padding="20" RowSpacing="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <VerticalStackLayout Grid.Row="0" Spacing="5">
                <Label Text="League of Legends Ranked Data"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="#c9aa71"
                       HorizontalOptions="Center" />
                <Label Text="Fetch and view your ranked game history"
                       FontSize="14"
                       TextColor="#a09b8c"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- Configuration Section -->
            <Frame Grid.Row="1" 
                   BackgroundColor="#16213e"
                   BorderColor="#0f3460"
                   CornerRadius="10"
                   Padding="15">
                <Grid ColumnSpacing="15" RowSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- API Key -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="5">
                        <Label Text="Riot API Key" TextColor="#a09b8c" FontSize="12" />
                        <Entry Placeholder="Enter your API key"
                               Text="{Binding ApiKey}"
                               IsPassword="True"
                               BackgroundColor="#0f3460"
                               TextColor="White"
                               PlaceholderColor="#666" />
                    </VerticalStackLayout>

                    <!-- Region -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="5">
                        <Label Text="Region" TextColor="#a09b8c" FontSize="12" />
                        <Picker ItemsSource="{Binding AvailableRegions}"
                                SelectedItem="{Binding SelectedRegion}"
                                BackgroundColor="#0f3460"
                                TextColor="White" />
                    </VerticalStackLayout>

                    <!-- Match Count -->
                    <VerticalStackLayout Grid.Column="2" Grid.Row="0" Spacing="5">
                        <Label Text="Match Count" TextColor="#a09b8c" FontSize="12" />
                        <Picker ItemsSource="{Binding MatchCountOptions}"
                                SelectedItem="{Binding MatchCount}"
                                BackgroundColor="#0f3460"
                                TextColor="White" />
                    </VerticalStackLayout>

                    <!-- Game Name -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="5">
                        <Label Text="Game Name" TextColor="#a09b8c" FontSize="12" />
                        <Entry Placeholder="SummonerName"
                               Text="{Binding GameName}"
                               BackgroundColor="#0f3460"
                               TextColor="White"
                               PlaceholderColor="#666" />
                    </VerticalStackLayout>

                    <!-- Tag Line -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="5">
                        <Label Text="Tag Line" TextColor="#a09b8c" FontSize="12" />
                        <Entry Placeholder="EUW"
                               Text="{Binding TagLine}"
                               BackgroundColor="#0f3460"
                               TextColor="White"
                               PlaceholderColor="#666" />
                    </VerticalStackLayout>

                    <!-- Buttons -->
                    <HorizontalStackLayout Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" 
                                           Spacing="10" 
                                           VerticalOptions="End">
                        <Button Text="Fetch Data"
                                Command="{Binding FetchRankedDataCommand}"
                                BackgroundColor="#c9aa71"
                                TextColor="#1a1a2e"
                                FontAttributes="Bold"
                                WidthRequest="120" />
                        <Button Text="Clear"
                                Command="{Binding ClearDataCommand}"
                                BackgroundColor="#0f3460"
                                TextColor="White"
                                WidthRequest="80" />
                    </HorizontalStackLayout>
                </Grid>
            </Frame>

            <!-- Status/Error Messages -->
            <VerticalStackLayout Grid.Row="2" Spacing="5">
                <Label Text="{Binding StatusMessage}"
                       TextColor="#a09b8c"
                       FontSize="12"
                       IsVisible="{Binding StatusMessage, Converter={StaticResource StringToBoolConverter}}" />
                <Label Text="{Binding ErrorMessage}"
                       TextColor="#dc3545"
                       FontSize="12"
                       FontAttributes="Bold"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}" />
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   IsVisible="{Binding IsLoading}"
                                   Color="#c9aa71"
                                   HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- Rank Info Section -->
            <Grid Grid.Row="3" 
                  ColumnSpacing="15"
                  IsVisible="{Binding CurrentAccount, Converter={StaticResource ObjectToBoolConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Solo Queue -->
                <Frame Grid.Column="0"
                       BackgroundColor="#16213e"
                       BorderColor="#0f3460"
                       CornerRadius="10"
                       Padding="15"
                       IsVisible="{Binding SoloQueueEntry, Converter={StaticResource ObjectToBoolConverter}}">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Ranked Solo/Duo" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="#c9aa71" />
                        <Label Text="{Binding SoloQueueEntry.RankDisplay}" 
                               FontSize="24" 
                               FontAttributes="Bold"
                               TextColor="White" />
                        <HorizontalStackLayout Spacing="10">
                            <Label TextColor="#28a745">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding SoloQueueEntry.Wins}" FontAttributes="Bold" />
                                        <Span Text="W" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label TextColor="#dc3545">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding SoloQueueEntry.Losses}" FontAttributes="Bold" />
                                        <Span Text="L" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label TextColor="#a09b8c">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding SoloQueueEntry.WinRate, StringFormat='{0:F1}%'}" />
                                        <Span Text=" WR" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Flex Queue -->
                <Frame Grid.Column="1"
                       BackgroundColor="#16213e"
                       BorderColor="#0f3460"
                       CornerRadius="10"
                       Padding="15"
                       IsVisible="{Binding FlexQueueEntry, Converter={StaticResource ObjectToBoolConverter}}">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Ranked Flex" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="#c9aa71" />
                        <Label Text="{Binding FlexQueueEntry.RankDisplay}" 
                               FontSize="24" 
                               FontAttributes="Bold"
                               TextColor="White" />
                        <HorizontalStackLayout Spacing="10">
                            <Label TextColor="#28a745">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding FlexQueueEntry.Wins}" FontAttributes="Bold" />
                                        <Span Text="W" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label TextColor="#dc3545">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding FlexQueueEntry.Losses}" FontAttributes="Bold" />
                                        <Span Text="L" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label TextColor="#a09b8c">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding FlexQueueEntry.WinRate, StringFormat='{0:F1}%'}" />
                                        <Span Text=" WR" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- Ranked Games List -->
            <Frame Grid.Row="4"
                   BackgroundColor="#16213e"
                   BorderColor="#0f3460"
                   CornerRadius="10"
                   Padding="10">
                <CollectionView ItemsSource="{Binding RankedGames}"
                                EmptyView="No ranked games found. Enter your details and click 'Fetch Data'.">
                    <CollectionView.EmptyViewTemplate>
                        <DataTemplate>
                            <Label Text="No ranked games found. Enter your details and click 'Fetch Data'."
                                   TextColor="#a09b8c"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   Margin="20" />
                        </DataTemplate>
                    </CollectionView.EmptyViewTemplate>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="0,5"
                                   Padding="15"
                                   BackgroundColor="#1a1a2e"
                                   BorderColor="{Binding ResultColor}"
                                   CornerRadius="8">
                                <Grid ColumnSpacing="15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Result -->
                                    <Label Grid.Column="0"
                                           Text="{Binding Result}"
                                           FontAttributes="Bold"
                                           TextColor="{Binding ResultColor}"
                                           WidthRequest="60"
                                           VerticalOptions="Center" />

                                    <!-- Champion -->
                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding Champion}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="{Binding Role}"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- KDA -->
                                    <VerticalStackLayout Grid.Column="2" VerticalOptions="Center">
                                        <Label Text="{Binding Kda}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="White" />
                                        <Label Text="{Binding KdaRatio, StringFormat='{0:F2} KDA'}"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- CS -->
                                    <VerticalStackLayout Grid.Column="3" VerticalOptions="Center">
                                        <Label Text="{Binding Cs}"
                                               FontSize="14"
                                               TextColor="White" />
                                        <Label Text="CS"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- Vision -->
                                    <VerticalStackLayout Grid.Column="4" VerticalOptions="Center">
                                        <Label Text="{Binding VisionScore}"
                                               FontSize="14"
                                               TextColor="White" />
                                        <Label Text="Vision"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- Damage -->
                                    <VerticalStackLayout Grid.Column="5" VerticalOptions="Center">
                                        <Label Text="{Binding DamageDealt, StringFormat='{0:N0}'}"
                                               FontSize="14"
                                               TextColor="White" />
                                        <Label Text="Damage"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- Queue Type -->
                                    <VerticalStackLayout Grid.Column="6" VerticalOptions="Center">
                                        <Label Text="{Binding QueueType}"
                                               FontSize="14"
                                               TextColor="White" />
                                        <Label Text="{Binding Duration}"
                                               FontSize="11"
                                               TextColor="#a09b8c" />
                                    </VerticalStackLayout>

                                    <!-- Date -->
                                    <Label Grid.Column="7"
                                           Text="{Binding GameDate, StringFormat='{0:MMM dd, yyyy}'}"
                                           FontSize="12"
                                           TextColor="#a09b8c"
                                           VerticalOptions="Center"
                                           HorizontalOptions="End" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>
        </Grid>
    </ScrollView>
</ContentPage>
